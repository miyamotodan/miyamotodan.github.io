<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Misuratore di Distanze</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <!-- Toolbar principale -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <span class="navbar-brand">
                <i class="fas fa-ruler"></i> Misuratore Distanze
            </span>
            
            <!-- Toolbar controls -->
            <div class="navbar-nav ms-auto d-flex flex-row gap-2">
                <!-- Toggle Preview -->
                <div class="nav-item">
                    <button class="btn btn-outline-light btn-sm active" id="toggle-preview" title="Mostra/Nascondi Anteprima">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>

                <!-- Modalità disegno -->
                <div class="nav-item">
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-light active" id="mode-segment" title="Modalità Segmento">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="btn btn-outline-light" id="mode-continuous" title="Modalità Segmento Continuativo">
                            <i class="fas fa-wave-square"></i>
                        </button>
                        <button class="btn btn-outline-light" id="mode-rectangle" title="Modalità Rettangolo">
                            <i class="fas fa-square"></i>
                        </button>
                        <button class="btn btn-outline-warning" id="cancel-drawing" title="Annulla Disegno (ESC)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Upload immagine -->
                <div class="nav-item">
                    <input type="file" id="upload" accept="image/*" class="d-none">
                    <label for="upload" class="btn btn-outline-light btn-sm">
                        <i class="fas fa-upload"></i> <span class="d-none d-md-inline">Carica</span>
                    </label>
                </div>
                
                <!-- Controlli zoom -->
                <div class="nav-item">
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-light" id="zoom-out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="btn btn-outline-light" id="zoom-in">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="btn btn-outline-light" id="reset">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Elimina tutti -->
                <div class="nav-item">
                    <button class="btn btn-outline-danger btn-sm" id="deleteall">
                        <i class="fas fa-trash"></i> <span class="d-none d-md-inline">Pulisci</span>
                    </button>
                </div>
                
                <!-- Theme selector -->
                <div class="nav-item">
                    <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-light" id="theme-light" title="Tema Chiaro">
                            <i class="fas fa-sun"></i>
                        </button>
                        <button class="btn btn-outline-light active" id="theme-dark" title="Tema Scuro">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button class="btn btn-outline-light" id="theme-contrast" title="Alto Contrasto">
                            <i class="fas fa-adjust"></i>
                        </button>
                    </div>
                </div>

                <!-- Settings -->
                <div class="nav-item">
                    <button class="btn btn-outline-light btn-sm" data-bs-toggle="offcanvas" data-bs-target="#settingsPanel">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>

                <!-- Debug -->
                <div class="nav-item">
                    <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#debugModal">
                        <i class="fas fa-bug"></i>
                    </button>
                </div>

                <!-- Help -->
                <div class="nav-item">
                    <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#helpModal">
                        <i class="fas fa-question-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Area canvas principale -->
    <div class="canvas-container position-relative">
        <canvas id="canvas"></canvas>
        
        <!-- Overlay per feedback visivo -->
        <div id="canvas-overlay">
            <div id="crosshair" class="crosshair"></div>
            <div id="touch-indicator" class="touch-indicator"></div>
        </div>
        
    </div>

    <!-- Pannello impostazioni (Offcanvas) -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="settingsPanel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Impostazioni</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            
            <!-- Configurazione scala -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-ruler-horizontal"></i> Configurazione Scala
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row g-2 mb-2">
                        <div class="col-6">
                            <label class="form-label">Riferimento (px)</label>
                            <input type="number" id="scale" value="1" class="form-control" step="0.1">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Misura reale (mm)</label>
                            <input type="number" id="real" value="1" class="form-control" step="0.1">
                        </div>
                    </div>
                    <div class="mt-2">
                        <label class="form-label">Segmento selezionato (mm)</label>
                        <input type="text" id="realsel" disabled class="form-control">
                    </div>
                </div>
            </div>

            <!-- Lista segmenti -->
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-list"></i> Misure Effettuate
                    </h6>
                    <span class="badge bg-secondary" id="segments-count">0</span>
                </div>
                <div class="card-body p-0">
                    <div id="segments-list" class="list-group list-group-flush">
                        <div class="list-group-item text-muted text-center">
                            Nessun segmento creato
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060;">
        <div id="info-toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Info</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-body">
                <!-- Contenuto del toast -->
            </div>
        </div>
    </div>
    
    <!-- Status bar -->
    <div class="position-fixed bottom-0 start-0 w-100 bg-dark text-light py-1 px-3" style="z-index: 1050; font-size: 0.875rem;">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <span id="zoom-level">Zoom: 100%</span>
                <span class="mx-2">|</span>
                <span id="current-measurement">Nessuna selezione</span>
            </div>
            <div>
                <span id="segments-status">0 misure</span>
            </div>
        </div>
    </div>

    <!-- Modale Help & Credits -->
    <div class="modal fade" id="helpModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-question-circle me-2"></i>Guida & Informazioni
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Manuale d'uso -->
                    <section class="mb-4">
                        <h5 class="text-primary mb-3">
                            <i class="fas fa-book me-2"></i>Manuale d'Uso
                        </h5>
                        <p class="lead">
                            <strong>ImgMeasure</strong> è uno strumento per misurare distanze su immagini, ideale per copiare disegni su carta partendo da una fotografia o scansione.
                        </p>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-upload me-2"></i><strong>1. Carica un'Immagine</strong>
                            </div>
                            <div class="card-body">
                                Clicca sul pulsante <span class="badge bg-secondary">Carica</span> e seleziona la foto del disegno che vuoi riprodurre.
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-ruler me-2"></i><strong>2. Definisci la Scala di Riferimento</strong>
                            </div>
                            <div class="card-body">
                                <ol class="mb-0">
                                    <li>Disegna un segmento su una dimensione nota nell'immagine (es. un oggetto di cui conosci la misura reale)</li>
                                    <li>Clicca sul segmento per selezionarlo</li>
                                    <li>Nelle <strong>Impostazioni</strong>, inserisci la misura reale in millimetri</li>
                                    <li>Tutte le successive misure saranno calcolate automaticamente in base a questa scala</li>
                                </ol>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-drafting-compass me-2"></i><strong>3. Modalità di Disegno</strong>
                            </div>
                            <div class="card-body">
                                <p><i class="fas fa-minus text-danger me-2"></i><strong>Segmento:</strong> Clicca due volte per creare una linea di misura singola</p>
                                <p><i class="fas fa-wave-square text-danger me-2"></i><strong>Continuativo:</strong> Crea segmenti consecutivi - ogni punto finale diventa l'inizio del successivo (ideale per polilinee e percorsi)</p>
                                <p class="mb-0"><i class="fas fa-square text-danger me-2"></i><strong>Rettangolo:</strong> Clicca due vertici opposti per creare un rettangolo (4 segmenti) - utile per misurare larghezza e altezza simultaneamente</p>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-eye me-2"></i><strong>4. Anteprima</strong>
                            </div>
                            <div class="card-body">
                                Il pulsante <i class="fas fa-eye text-success"></i> attiva/disattiva l'anteprima in tempo reale mentre disegni. Quando attiva, vedrai il segmento o rettangolo prima di confermarlo.
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-search me-2"></i><strong>5. Zoom e Navigazione</strong>
                            </div>
                            <div class="card-body">
                                <p><strong>Desktop:</strong> Tasto destro + trascina per spostare, bottoni <i class="fas fa-search-plus"></i>/<i class="fas fa-search-minus"></i> per zoom</p>
                                <p class="mb-0"><strong>Touch:</strong> Pinch per zoom, un dito per spostare, doppio tap per reset</p>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-magnet me-2"></i><strong>6. Aggancio Automatico (Snap)</strong>
                            </div>
                            <div class="card-body">
                                <p class="mb-2">Quando clicchi vicino a un punto esistente (entro 20px), il nuovo punto si aggancia automaticamente all'endpoint per massima precisione.</p>
                                <p class="mb-2"><strong>Indicatore visivo:</strong> Un cerchio colorato appare quando il cursore è vicino a un punto agganciabile</p>
                                <p class="mb-0"><strong>Utile per:</strong> Chiudere forme, creare percorsi continui precisi, connettere misure multiple</p>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-keyboard me-2"></i><strong>7. Scorciatoie e Controlli</strong>
                            </div>
                            <div class="card-body">
                                <p class="mb-2"><kbd>ESC</kbd> o <i class="fas fa-times text-warning"></i> - Annulla il disegno corrente (utile in modalità continuativa per terminare la catena)</p>
                                <p class="mb-0"><strong>Clic su primo punto:</strong> Deseleziona i segmenti per pulire la vista dalle etichette</p>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fas fa-palette me-2"></i><strong>8. Temi</strong>
                            </div>
                            <div class="card-body">
                                Scegli tra 3 temi per migliorare la visibilità:
                                <ul class="mb-0">
                                    <li><i class="fas fa-sun text-warning me-2"></i><strong>Chiaro</strong> - Ideale per ambienti luminosi</li>
                                    <li><i class="fas fa-moon text-info me-2"></i><strong>Scuro</strong> - Riduce l'affaticamento visivo</li>
                                    <li><i class="fas fa-adjust me-2"></i><strong>Alto Contrasto</strong> - Massima accessibilità</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <hr class="my-4">

                    <!-- Credits & Donazioni -->
                    <section class="text-center">
                        <h5 class="text-primary mb-3">
                            <i class="fas fa-heart me-2"></i>Supporta il Progetto
                        </h5>
                        <p>
                            <strong>ImgMeasure</strong> è un software <strong>gratuito e open source</strong> sviluppato per aiutare artisti, artigiani e creativi nel loro lavoro.
                        </p>
                        <p class="text-muted">
                            Se questo strumento ti è stato utile, considera una donazione volontaria per supportare lo sviluppo e la manutenzione del progetto.
                        </p>

                        <div class="card bg-light border-primary mb-3">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fab fa-paypal text-primary me-2"></i>Dona con PayPal
                                </h6>
                                <p class="card-text small text-muted mb-3">
                                    Anche un piccolo contributo fa la differenza!
                                </p>
                                <a href="https://www.paypal.com/donate" target="_blank" class="btn btn-primary">
                                    <i class="fab fa-paypal me-2"></i>Dona Ora
                                </a>
                                <p class="small text-muted mt-2 mb-0">
                                    oppure invia a: <strong>donate@imgmeasure.app</strong>
                                </p>
                            </div>
                        </div>

                        <div class="mt-4">
                            <p class="small text-muted mb-1">
                                <i class="fas fa-code me-2"></i>Sviluppato con <i class="fas fa-heart text-danger"></i> per la comunità creativa
                            </p>
                            <p class="small text-muted mb-1">
                                © 2024 ImgMeasure - Licenza Open Source
                            </p>
                            <p class="small text-muted">
                                Versione 1.0.6 debug
                            </p>
                        </div>
                    </section>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Modal -->
    <div class="modal fade" id="debugModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="fas fa-bug me-2"></i>Debug Log
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <button class="btn btn-sm btn-danger" id="clear-debug-log">
                            <i class="fas fa-trash me-1"></i>Pulisci Log
                        </button>
                    </div>
                    <div id="debug-log" style="font-family: monospace; font-size: 0.85rem; max-height: 500px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                        <div class="text-muted">Log eventi pronto...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modali per conferme -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title">Conferma</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modal-body">
                    Sei sicuro di voler procedere?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-danger btn-sm" id="confirm-action">Conferma</button>
                </div>
            </div>
        </div>
    </div>

    <script src="bootstrap.bundle.min.js"></script>
    <script src="main.js"></script>

</body>

</html>